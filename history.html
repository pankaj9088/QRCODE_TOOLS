<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code History</title>
    <link rel="stylesheet" href="css/style1.css">
    <style>
        .history-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .history-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        body.dark-mode .history-item {
            background: #2a2a2a;
        }

        .history-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .history-item img {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .history-text {
            font-size: 12px;
            color: #666;
            margin: 5px 0;
            word-break: break-word;
        }

        body.dark-mode .history-text {
            color: #aaa;
        }

        .history-date {
            font-size: 11px;
            color: #999;
        }

        .history-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .history-actions button {
            flex: 1;
            padding: 6px;
            font-size: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .back-btn {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 8px;
            display: inline-block;
        }

        .clear-btn {
            background: #dc3545;
            color: white;
        }
    </style>
</head>

<body>
    <div class="history-container">
        <div class="history-header">
            <h2>üìú QR Code History</h2>
            <div>
                <button id="darkModeToggle" class="theme-toggle">üåô Dark Mode</button>
                <a href="text-to-qr.html" class="back-btn">‚Üê Back</a>
            </div>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <p id="historyCount" style="color: #666;">Loading...</p>
            <button id="clearHistory" class="clear-btn"
                style="padding: 8px 15px; border-radius: 6px; border: none; cursor: pointer;">üóëÔ∏è Clear All</button>
        </div>

        <div id="historyGrid" class="history-grid">
            <!-- History items will be loaded here -->
        </div>
    </div>

    <script>
        // Dark mode toggle
        const darkModeToggle = document.getElementById('darkModeToggle');
        const historyGrid = document.getElementById('historyGrid');
        const historyCount = document.getElementById('historyCount');
        const clearHistoryBtn = document.getElementById('clearHistory');

        // Load dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
            darkModeToggle.textContent = '‚òÄÔ∏è Light Mode';
        }

        darkModeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            darkModeToggle.textContent = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
            localStorage.setItem('darkMode', isDark);
        });

        // Load history
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('qrHistory') || '[]');

            if (history.length === 0) {
                historyGrid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <h3>üì≠ No History Yet</h3>
                        <p>Generate and save some QR codes to see them here!</p>
                        <a href="text-to-qr.html" class="back-btn" style="margin-top: 20px;">Create QR Code</a>
                    </div>
                `;
                historyCount.textContent = 'No saved QR codes';
                clearHistoryBtn.style.display = 'none';
                return;
            }

            historyCount.textContent = `${history.length} saved QR code${history.length > 1 ? 's' : ''}`;
            clearHistoryBtn.style.display = 'block';

            historyGrid.innerHTML = history.map((item, index) => {
                const date = new Date(item.timestamp);
                const dateStr = date.toLocaleDateString() + ' ' + date.toLocaleTimeString();

                return `
                    <div class="history-item">
                        <img src="${item.image}" alt="QR Code">
                        <div class="history-text"><strong>Text:</strong> ${item.text.substring(0, 50)}${item.text.length > 50 ? '...' : ''}</div>
                        <div class="history-text"><strong>Size:</strong> ${item.size}px</div>
                        <div class="history-date">${dateStr}</div>
                        <div class="history-actions">
                            <button onclick="downloadQR(${index})" style="background: #28a745; color: white;">‚¨áÔ∏è Download</button>
                            <button onclick="deleteQR(${index})" style="background: #dc3545; color: white;">üóëÔ∏è Delete</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Download QR from history
        window.downloadQR = function (index) {
            const history = JSON.parse(localStorage.getItem('qrHistory') || '[]');
            if (history[index]) {
                const link = document.createElement('a');
                link.download = `qrcode-${index + 1}.png`;
                link.href = history[index].image;
                link.click();
            }
        };

        // Delete single QR
        window.deleteQR = function (index) {
            if (confirm('Delete this QR code from history?')) {
                let history = JSON.parse(localStorage.getItem('qrHistory') || '[]');
                history.splice(index, 1);
                localStorage.setItem('qrHistory', JSON.stringify(history));
                loadHistory();
            }
        };

        // Clear all history
        clearHistoryBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to clear all history? This cannot be undone!')) {
                localStorage.removeItem('qrHistory');
                loadHistory();
            }
        });

        // Load on page load
        loadHistory();
    </script>
</body>

</html>